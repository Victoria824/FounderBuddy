(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5346:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>B,patchFetch:()=>A,routeModule:()=>w,serverHooks:()=>z,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>y});var d={};c.r(d),c.d(d,{POST:()=>v});var e=c(6559),f=c(8088),g=c(7719),h=c(6191),i=c(1289),j=c(261),k=c(2603),l=c(9893),m=c(4823),n=c(7220),o=c(6946),p=c(7912),q=c(9786),r=c(6143),s=c(6439),t=c(3365);let u=(a,b,c="INFO")=>{let d=new Date().toISOString();("INFO"!==c||"true"===process.env.ENABLE_DEBUG_LOGS)&&(console.log(`
${"ERROR"===c?"\uD83D\uDD34":"WARN"===c?"\uD83D\uDFE1":"\uD83D\uDD35"} === API CALL LOG [${c}] [${a}] - ${d} ===`),console.log(JSON.stringify(b,null,2)),console.log("=====================================\n"))};async function v(a){let b=Date.now();try{let{messages:c,userId:d,threadId:e,mode:f="stream",agentId:g="value-canvas"}=await a.json(),h=c[c.length-1]?.content||"";u("REQUEST_START",{timestamp:new Date().toISOString(),requestId:`req_${b}`,requestHeaders:Object.fromEntries(a.headers.entries()),requestUrl:a.url,requestMethod:a.method,input:{userId:d,threadId:e,agentId:g,messageCount:c.length,latestMessage:h,allMessages:c},environment:{nodeEnv:"production",apiEnv:"local",hasAuthToken:!!process.env.VALUE_CANVAS_API_TOKEN}});let i=(a=>{if(null==a)throw Error("user_id is required and must be provided");let b=Number(a);if(!Number.isInteger(b)||b<=0)throw Error("user_id must be a positive integer");return b})(d),j={message:h,user_id:i};"stream"===f&&(j.stream_tokens=!0),e&&(j.thread_id=e);let k=process.env.VALUE_CANVAS_API_URL_LOCAL;if(!k){let a="Backend API URL not configured. Please set VALUE_CANVAS_API_URL_LOCAL environment variable.";return u("CONFIGURATION_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,error:{message:a,isLocal:!0,apiEnv:"local"}},"ERROR"),new Response(JSON.stringify({content:`Configuration Error: ${a}`,threadId:null,userId:null}),{status:500,headers:{"Content-Type":"application/json"}})}let l=`${k}/${g}/${"stream"===f?"stream":"invoke"}`;u("EXTERNAL_API_REQUEST",{timestamp:new Date().toISOString(),requestId:`req_${b}`,externalApi:{url:l,method:"POST",headers:{"Content-Type":"application/json",hasAuthToken:!!process.env.VALUE_CANVAS_API_TOKEN},body:j},processedData:{originalUserId:d,finalUserId:i,originalThreadId:e,messageLength:h.length,isLocal:!0}});let m=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",...process.env.VALUE_CANVAS_API_TOKEN&&{Authorization:`Bearer ${process.env.VALUE_CANVAS_API_TOKEN}`}},body:JSON.stringify(j)}),n=Date.now()-b;if(u("EXTERNAL_API_RESPONSE",{timestamp:new Date().toISOString(),requestId:`req_${b}`,response:{status:m.status,statusText:m.statusText,headers:Object.fromEntries(m.headers.entries()),ok:m.ok},performance:{responseTime:`${n}ms`,startTime:b}}),!m.ok){let a=await m.text();throw u("API_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,error:{status:m.status,statusText:m.statusText,errorText:a,responseTime:`${n}ms`}},"ERROR"),Error(`HTTP error! status: ${m.status}`)}if("invoke"===f){let a=await m.json();return u("INVOKE_SUCCESS",{timestamp:new Date().toISOString(),requestId:`req_${b}`,response:{contentLength:a.output?.content?.length||0,threadId:a.thread_id,userId:a.user_id}}),Response.json({content:a.output?.content||"",threadId:a.thread_id,userId:a.user_id,section:a.output?.custom_data?.section||null,mode:"invoke"})}let o=new TextEncoder,p="",q=null,r=null,s=null,t=0,v=0,w=Date.now(),x=new ReadableStream({async start(a){let c=m.body?.getReader(),d=new TextDecoder,e=null,f=!1,g=b=>{if(!f)try{a.enqueue(b)}catch(a){console.warn("Failed to enqueue data:",a)}},h=()=>{if(!f){f=!0,e&&clearTimeout(e);try{a.close()}catch(a){console.warn("Failed to close controller:",a)}}},j=()=>{e&&clearTimeout(e),f||(e=setTimeout(()=>{u("STREAM_TIMEOUT",{timestamp:new Date().toISOString(),requestId:`req_${b}`,timeoutInfo:{timeoutDuration:3e4,lastActivityTime:new Date(w).toISOString(),chunkCount:t,tokenCount:v,inactiveTime:`${Date.now()-w}ms`}},"ERROR"),f||(a.error(Error("Stream timeout - no data received for 30 seconds")),f=!0)},3e4))};if(j(),u("STREAM_READER_INIT",{timestamp:new Date().toISOString(),requestId:`req_${b}`,streamSetup:{hasReader:!!c,responseBodyExists:!!m.body,timeoutConfigured:3e4}}),!c){u("STREAM_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,error:{type:"NO_READER",message:"No reader available from response body"}},"ERROR"),h();return}try{for(;;){let a=Date.now(),{done:e,value:f}=await c.read(),k=Date.now()-a;if(e){u("STREAM_COMPLETE",{timestamp:new Date().toISOString(),requestId:`req_${b}`,streamStats:{totalChunks:t,totalTokens:v,finalContentLength:p.length,totalStreamTime:`${Date.now()-b}ms`,lastActivityTime:new Date(w).toISOString()}});break}t++,w=Date.now(),j();let l=d.decode(f,{stream:!0}),m=l.split("\n");for(let a of(u("STREAM_CHUNK_RECEIVED",{timestamp:new Date().toISOString(),requestId:`req_${b}`,chunkData:{chunkNumber:t,chunkSize:f?.length||0,readTime:`${k}ms`,linesCount:m.length,rawChunk:l.substring(0,200)+(l.length>200?"...":""),chunkLength:l.length}}),m))if(a.startsWith("data: ")){let c=a.slice(6);if("[DONE]"===c){let a={type:"final_response",content:p,threadId:q,userId:r||i,section:s};u("STREAM_SENDING_FINAL",{timestamp:new Date().toISOString(),requestId:`req_${b}`,finalData:{contentLength:p.length,threadId:q,userId:r||i,hasSection:!!s,totalTokens:v,totalChunks:t}}),g(o.encode(`data: ${JSON.stringify(a)}

`)),g(o.encode("data: [DONE]\n\n")),h();return}try{let a=JSON.parse(c);u("STREAM_DATA_PARSED",{timestamp:new Date().toISOString(),requestId:`req_${b}`,parsedData:{type:a.type,contentLength:a.content?.length||0,hasRunId:!!a.content?.run_id,hasCustomData:!!a.content?.custom_data,rawDataSample:c.substring(0,100)+(c.length>100?"...":"")}}),"token"===a.type?(v++,p+=a.content):"message"===a.type?(p=a.content.content||p,a.content.run_id&&(q=a.content.run_id),a.content.custom_data&&(s=a.content.custom_data.section,r=a.content.custom_data.user_id)):"section"===a.type&&(s=a.content),g(o.encode(`data: ${JSON.stringify(a)}

`))}catch(d){u("STREAM_PARSE_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,parseError:{error:d instanceof Error?d.message:"Unknown parse error",rawData:c,chunkNumber:t,lineNumber:m.indexOf(a)}},"WARN"),console.error("Failed to parse stream data:",d,c)}}}}catch(c){u("STREAM_PROCESSING_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,streamError:{error:c instanceof Error?c.message:"Unknown stream error",stack:c instanceof Error?c.stack:void 0,chunkCount:t,tokenCount:v,lastActivityTime:new Date(w).toISOString(),streamDuration:`${Date.now()-b}ms`}},"ERROR"),console.error("Stream processing error:",c),f||(a.error(c),f=!0),e&&clearTimeout(e)}}});return u("STREAM_START",{timestamp:new Date().toISOString(),requestId:`req_${b}`,streamSetup:{responseHeaders:Object.fromEntries(m.headers.entries())}}),new Response(x,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}catch(c){let a=Date.now()-b;return u("REQUEST_ERROR",{timestamp:new Date().toISOString(),requestId:`req_${b}`,error:{message:c instanceof Error?c.message:"Unknown error",stack:c instanceof Error?c.stack:void 0,type:c?.constructor?.name||"Unknown"},performance:{errorResponseTime:`${a}ms`,requestStartTime:b,errorTime:Date.now()}},"ERROR"),new Response(JSON.stringify({content:`Error: ${c instanceof Error?c.message:"Unknown error"}`,threadId:null,userId:null}),{status:500,headers:{"Content-Type":"application/json"}})}}let w=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/victorialiu/Desktop/FounderBuddy/frontend/src/app/api/chat/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:x,workUnitAsyncStorage:y,serverHooks:z}=w;function A(){return(0,g.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:y})}async function B(a,b,c){var d;let e="/api/chat/route";"/index"===e&&(e="/");let g=await w.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:x,isDraftMode:y,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!y){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||w.isDev||y||(G="/index"===(G=D)?"/":G);let H=!0===w.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{dynamicIO:!!x.experimental.dynamicIO,authInterrupts:!!x.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=x.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>w.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>w.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await w.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await w.handleResponse({req:a,nextConfig:x,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),y&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||await w.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},6559:(a,b,c)=>{"use strict";a.exports=c(4870)},6946:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(898),e=c(2471),f=c(7912);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},8335:()=>{},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[431],()=>b(b.s=5346));module.exports=c})();